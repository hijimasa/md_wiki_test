<!--
  ref: https://qiita.com/gat3ta/items/1e9ada8d81d423d60493
-->
<!DOCTYPE html>
<html lang="jp">
  <head>
    <meta charset="utf-8">
    <title>hijimasa's wiki</title>
    <link rel="stylesheet" href="./styles/default.css" />
    <link rel="stylesheet" href="./styles/katex.min.css" />
    <script src="./lib/jquery-3.6.0.min.js"></script>
    <script src="./lib/marked.min.js"></script>
    <script src="./lib/mermaid.min.js"></script>
    <script src="./lib/highlight.min.js"></script>
    <script src="./lib/katex.min.js"></script>
    <!--
    MEMO: レンダリングを読み込み時にしない
    任意のタイミングで行うために、するのだ。
    ref: https://naosim.hatenablog.jp/entry/2018/02/20/071042
    -->
    <script>mermaid.initialize({startOnLoad:false});</script>
  </head>
  <body id="content">
    <script>
      var renderer = new marked.Renderer();
      renderer.code = function (code, language, escaped) {
        if(code.match(/^sequenceDiagram/)||code.match(/^graph/)||code.match(/^gantt/)){
           return '<div class="mermaid">' + code + '\n</div>';
        }else if (!language) {
          const mathsExpression = function (expr) {
            if (expr.match(/^\$\$[\s\S]*\$\$$/)) {
              expr = expr.substr(2, expr.length - 4)
              return katex.renderToString(expr, { displayMode: true, noannotation: true })
            } else if (expr.match(/^\$[\s\S]*\$$/)) {
              expr = expr.substr(1, expr.length - 2)
              return katex.renderToString(expr, { isplayMode: false })
            }
          };
          const math = mathsExpression(code);
          if (math) {
            return math
          }
        }else{
           return '<pre><code>\n' + hljs.highlightAuto(code).value + '\n</code></pre>';
        }
      };
      $(document).ready(function(){
        if (location.href.split("#!").length > 1){
          var urlParam = location.href.split("#!")[1];
        }else{
          var urlParam = "index.md";
        }
        $.get( urlParam, function( data ) {
          // Memo: markedのレンダリング-> marmaid.init()
          // ただし、あらかじめstartOnLoad:falseにしておかないと、
          // markedの前にmermaidが走ってしまって、mermaidで変換されない。
          $('#content').html(marked(data, { renderer: renderer }));
          mermaid.init();
        });
      });
    </script>
  </body>
</html>